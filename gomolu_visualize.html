<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<title>五子棋棋谱可视化 (15x15)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; background: #f5f5f5; padding: 20px; }
  .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
  h1 { color: #333; margin-bottom: 20px; }
  .input-section { margin-bottom: 20px; }
  .input-section label { display: block; margin-bottom: 8px; font-weight: 600; color: #555; }
  .input-section textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace; font-size: 14px; resize: vertical; min-height: 60px; }
  .button-group { display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap; }
  button { padding: 10px 16px; border: none; border-radius: 4px; font-size: 14px; cursor: pointer; font-weight: 600; transition: all 0.2s; }
  .btn-primary { background: #0b5cff; color: white; }
  .btn-primary:hover { background: #0a4dd8; }
  .btn-secondary { background: #f0f0f0; color: #333; border: 1px solid #ddd; }
  .btn-secondary:hover { background: #e8e8e8; }
  button:disabled { opacity: 0.5; cursor: not-allowed; }

  .nav-buttons { display: flex; gap: 8px; margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee; }
  .nav-buttons button { padding: 8px 12px; font-size: 13px; flex: 1; }
  .step-display { text-align: center; margin-top: 10px; font-size: 13px; color: #666; }
  .step-display .current-step { font-weight: bold; color: #0b5cff; }
  .error { color: #d32f2f; margin-top: 8px; padding: 10px; background: #ffebee; border-radius: 4px; display: none; }
  .info { color: #1976d2; margin-top: 8px; padding: 10px; background: #e3f2fd; border-radius: 4px; display: none; }

  .display-section { display: flex; gap: 20px; margin-top: 30px; flex-wrap: wrap; }
  .board-container { flex: 1; min-width: 400px; }
  .stats-container { flex: 0 0 200px; }

  /* SVG棋盘样式 */
  .board-svg { width: 100%; height: auto; border: 1px solid #ddd; border-radius: 4px; background: #deb887; }

  /* 统计信息 */
  .stats { background: #f9f9f9; padding: 15px; border-radius: 4px; border: 1px solid #e0e0e0; }
  .stat-item { margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid #eee; }
  .stat-item:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
  .stat-label { font-weight: 600; color: #555; font-size: 12px; text-transform: uppercase; }
  .stat-value { font-size: 24px; font-weight: bold; color: #0b5cff; margin-top: 4px; }
  .stat-color-black { color: #333; }
  .stat-color-white { color: #d32f2f; }

  .legend { margin-top: 20px; padding: 15px; background: #f9f9f9; border-radius: 4px; border: 1px solid #e0e0e0; }
  .legend h3 { margin-bottom: 10px; font-size: 14px; color: #555; }
  .legend-item { display: flex; gap: 10px; margin-bottom: 8px; font-size: 13px; }
  .legend-item span { font-family: monospace; color: #666; }
</style>
</head>
<body>
<div class="container">
  <h1>五子棋棋谱可视化 (15×15)</h1>
  
  <div class="input-section">
    <label for="moves">输入棋谱（支持多种格式，空格或逗号分隔）:</label>
    <textarea id="moves" placeholder="示例：
112 128 113 114 126 98
或 h8 i9 h7 h9 g8 i8
或 hh kk ih jj gg kh
或 112, 128, 113, 114, 126, 98"></textarea>
    <div class="button-group">
      <button class="btn-primary" onclick="visualize()">可视化</button>
      <button class="btn-secondary" onclick="clearAll()">清空</button>
    </div>
    <div id="error" class="error"></div>
    <div id="info" class="info"></div>
  </div>

  <div class="display-section">
    <div class="board-container">
      <svg id="board" class="board-svg" viewBox="0 0 900 900" preserveAspectRatio="xMidYMid meet"></svg>
    </div>
    <div class="stats-container">
        <div class="nav-buttons">
        <button class="btn-secondary" id="btn-start">⏮ 起始</button>
        <button class="btn-secondary" id="btn-prev">⏪ 上一步</button>
        <button class="btn-secondary" id="btn-next">⏩ 下一步</button>
        <button class="btn-secondary" id="btn-end">⏭ 结束</button>
      </div>
      <div class="step-display">
        <span id="step-info">未加载棋谱</span>
      </div>
      <div class="stats">
        <div class="stat-item">
          <div class="stat-label">总步数</div>
          <div class="stat-value" id="stat-moves">0</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">黑子 <span class="stat-color-black">●</span></div>
          <div class="stat-value stat-color-black" id="stat-black">0</div>
        </div>
        <div class="stat-item">
          <div class="stat-label">白子 <span class="stat-color-white">●</span></div>
          <div class="stat-value stat-color-white" id="stat-white">0</div>
        </div>
      </div>

      <div class="legend">
        <h3>支持的输入格式</h3>
        <div class="legend-item">
          <span>纯数字:</span> 112 128 113
        </div>
        <div class="legend-item">
          <span>字母字母:</span> hh kk ih
        </div>
        <div class="legend-item">
          <span>字母数字:</span> h8 i9 h7
        </div>
        <div style="margin-top: 10px; font-size: 12px; color: #999;">
          分隔符: 空格或逗号
        </div>
      </div>

      
    </div>
  </div>
</div>

<script>
const WIDTH = 15;
const HEIGHT = 15;
const VIEW = 900;
const MARGIN = 30;
const INNER = VIEW - MARGIN * 2;
const SPACING = INNER / (WIDTH - 1);

// 当前步数显示
let currentStep = 0;
let allMoves = [];

// 特殊位置标记（棋盘8h,4d,4l,12d,12l）
const SPECIAL_MARKS = [
  {row: 7, col: 7},   // 8h: h8 中心
  {row: 3, col: 3},   // 4d: d4 左上
  {row: 3, col: 11},  // 4l: l4 右上
  {row: 11, col: 3},  // 12d: d12 左下
  {row: 11, col: 11}  // 12l: l12 右下
];

// 显示错误消息
function showError(msg) {
  const el = document.getElementById('error');
  el.textContent = msg;
  el.style.display = 'block';
  document.getElementById('info').style.display = 'none';
}

// 显示信息消息
function showInfo(msg) {
  const el = document.getElementById('info');
  el.textContent = msg;
  el.style.display = 'block';
  document.getElementById('error').style.display = 'none';
}

// 清空错误信息
function clearMessages() {
  document.getElementById('error').style.display = 'none';
  document.getElementById('info').style.display = 'none';
}

// 解析落子位置（支持多种格式）
function parseMoves(input) {
  const moves = [];
  
  // 先规范化分隔符：将逗号替换为空格，然后按空格分割
  const normalized = input.trim().replace(/,/g, ' ').split(/\s+/).filter(x => x.length > 0);
  
  for (const token of normalized) {
    let move = null;
    
    // 1. 尝试纯数字格式：row*16 + col（如 112）
    if (/^\d+$/.test(token)) {
      const num = parseInt(token);
      const row = Math.floor(num / 16);
      const col = num % 16;
      if (row >= 0 && row < HEIGHT && col >= 0 && col < WIDTH) {
        move = row * WIDTH + col;
      }
    }
    // 2. 尝试字母数字格式：如 h8, i9（行用字母a-o，列用数字0-14）
    else if (/^[a-o]\d+$/.test(token.toLowerCase())) {
      const col = token.toLowerCase().charCodeAt(0) - 'a'.charCodeAt(0);
      const row = parseInt(token.substring(1));
      if (row >= 0 && row < HEIGHT && col >= 0 && col < WIDTH) {
        move = row * WIDTH + col;
      }
    }
    // 3. 尝试字母字母格式：如 hh, kk, ih（两个字母表示row和col）
    else if (/^[a-o][a-o]$/.test(token.toLowerCase())) {
      const row = token.toLowerCase().charCodeAt(0) - 'a'.charCodeAt(0);
      const col = token.toLowerCase().charCodeAt(1) - 'a'.charCodeAt(0);
      if (row >= 0 && row < HEIGHT && col >= 0 && col < WIDTH) {
        move = row * WIDTH + col;
      }
    }
    
    if (move === null) {
      throw new Error(`无法解析坐标: "${token}"`);
    }
    
    moves.push(move);
  }
  
  // 检查是否有重复
  const seen = new Set();
  for (const m of moves) {
    if (seen.has(m)) {
      throw new Error(`重复的坐标: 位置 ${m}`);
    }
    seen.add(m);
  }
  
  return moves;
}

// 绘制棋盘（支持分步显示）
function drawBoard(moves, displaySteps = moves.length) {
  const svg = document.getElementById('board');
  svg.innerHTML = '';
  
  // SVG 主容器的宽度需要空间放坐标标签
  const svgWidth = VIEW + 60;
  const svgHeight = VIEW + 60;
  svg.setAttribute('viewBox', `0 0 ${svgWidth} ${svgHeight}`);
  
  // 背景
  const bg = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
  bg.setAttribute('x', MARGIN + 30);
  bg.setAttribute('y', MARGIN + 30);
  bg.setAttribute('width', INNER);
  bg.setAttribute('height', INNER);
  bg.setAttribute('fill', '#deb887');
  bg.setAttribute('rx', 6);
  svg.appendChild(bg);
  
  // 竖线
  for (let i = 0; i < WIDTH; i++) {
    const x = MARGIN + 30 + i * SPACING;
    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
    line.setAttribute('x1', x);
    line.setAttribute('y1', MARGIN + 30);
    line.setAttribute('x2', x);
    line.setAttribute('y2', MARGIN + 30 + INNER);
    line.setAttribute('stroke', '#333');
    line.setAttribute('stroke-width', 1);
    svg.appendChild(line);
  }
  
  // 横线
  for (let j = 0; j < HEIGHT; j++) {
    const y = MARGIN + 30 + j * SPACING;
    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
    line.setAttribute('x1', MARGIN + 30);
    line.setAttribute('y1', y);
    line.setAttribute('x2', MARGIN + 30 + INNER);
    line.setAttribute('y2', y);
    line.setAttribute('stroke', '#333');
    line.setAttribute('stroke-width', 1);
    svg.appendChild(line);
  }
  
  // 特殊位置标记（小圆点）
  for (const mark of SPECIAL_MARKS) {
    const x = MARGIN + 30 + mark.col * SPACING;
    const y = MARGIN + 30 + mark.row * SPACING;
    const dot = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
    dot.setAttribute('cx', x);
    dot.setAttribute('cy', y);
    dot.setAttribute('r', 5);
    dot.setAttribute('fill', '#000');
    dot.setAttribute('opacity', '1');
    svg.appendChild(dot);
  }
  
  // 左侧行号标签（1-15）
  for (let j = 0; j < HEIGHT; j++) {
    const y = MARGIN + 30 + j * SPACING;
    const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
    label.setAttribute('x', MARGIN + 6);
    label.setAttribute('y', y);
    label.setAttribute('text-anchor', 'middle');
    label.setAttribute('dominant-baseline', 'middle');
    label.setAttribute('font-size', '36');
    label.setAttribute('fill', '#666');
    label.textContent = j + 1;
    svg.appendChild(label);
  }
  
  // 上面列号标签（a-o）
  for (let i = 0; i < WIDTH; i++) {
    const x = MARGIN + 30 + i * SPACING;
    const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
    label.setAttribute('x', x);
    label.setAttribute('y', MARGIN + 8);
    label.setAttribute('text-anchor', 'middle');
    label.setAttribute('dominant-baseline', 'middle');
    label.setAttribute('font-size', '36');
    label.setAttribute('fill', '#666');
    label.textContent = String.fromCharCode('a'.charCodeAt(0) + i);
    svg.appendChild(label);
  }
  
  // 绘制棋子（仅显示 displaySteps 步）
  const stones = document.createElementNS('http://www.w3.org/2000/svg', 'g');
  stones.id = 'stones';
  svg.appendChild(stones);
  
  for (let step = 0; step < Math.min(displaySteps, moves.length); step++) {
    const move = moves[step];
    const row = Math.floor(move / WIDTH);
    const col = move % WIDTH;
    const cx = MARGIN + 30 + col * SPACING;
    const cy = MARGIN + 30 + row * SPACING;
    const isBlack = step % 2 === 0; // 先手是黑子
    
    // 石子圆形
    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
    circle.setAttribute('cx', cx);
    circle.setAttribute('cy', cy);
    circle.setAttribute('r', SPACING * 0.35);
    circle.setAttribute('fill', isBlack ? '#333' : '#f0f0f0');
    circle.setAttribute('stroke', isBlack ? 'none' : '#333');
    circle.setAttribute('stroke-width', 1);
    stones.appendChild(circle);
    
    // 步数文字
    const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
    text.setAttribute('x', cx);
    text.setAttribute('y', cy);
    text.setAttribute('text-anchor', 'middle');
    text.setAttribute('dominant-baseline', 'middle');
    text.setAttribute('font-size', Math.max(10, SPACING * 0.35));
    text.setAttribute('font-weight', 'bold');
    text.setAttribute('fill', isBlack ? '#fff' : '#333');
    text.setAttribute('pointer-events', 'none');
    text.textContent = step + 1;
    stones.appendChild(text);
  }
}

// 更新统计信息
function updateStats(moves) {
  const black = Math.ceil(moves.length / 2);
  const white = Math.floor(moves.length / 2);
  
  document.getElementById('stat-moves').textContent = moves.length;
  document.getElementById('stat-black').textContent = black;
  document.getElementById('stat-white').textContent = white;
}

// 更新步数显示
function updateStepInfo() {
  const totalSteps = allMoves.length;
  if (totalSteps === 0) {
    document.getElementById('step-info').textContent = '未加载棋谱';
    return;
  }
  
  const info = document.getElementById('step-info');
  if (currentStep === 0) {
    info.innerHTML = '开局';
  } else if (currentStep === totalSteps) {
    info.innerHTML = `第 <span class="current-step">${currentStep}</span> / ${totalSteps} 步 (完)`;
  } else {
    info.innerHTML = `第 <span class="current-step">${currentStep}</span> / ${totalSteps} 步`;
  }
  
  // 更新导航按钮状态
  document.getElementById('btn-start').disabled = currentStep === 0;
  document.getElementById('btn-prev').disabled = currentStep === 0;
  document.getElementById('btn-next').disabled = currentStep === totalSteps;
  document.getElementById('btn-end').disabled = currentStep === totalSteps;
}

// 导航功能
function goToStart() {
  currentStep = 0;
  drawBoard(allMoves, currentStep);
  updateStepInfo();
}

function goToPrev() {
  if (currentStep > 0) {
    currentStep--;
    drawBoard(allMoves, currentStep);
    updateStepInfo();
  }
}

function goToNext() {
  if (currentStep < allMoves.length) {
    currentStep++;
    drawBoard(allMoves, currentStep);
    updateStepInfo();
  }
}

function goToEnd() {
  currentStep = allMoves.length;
  drawBoard(allMoves, currentStep);
  updateStepInfo();
}

// 可视化
function visualize() {
  clearMessages();
  
  const input = document.getElementById('moves').value.trim();
  if (!input) {
    showError('请输入棋谱');
    return;
  }
  
  try {
    const moves = parseMoves(input);
    if (moves.length === 0) {
      showError('未检测到任何坐标');
      return;
    }
    
    // 保存棋谱并重置步数
    allMoves = moves;
    currentStep = moves.length;
    
    // 绘制棋盘和统计信息
    drawBoard(moves, moves.length);
    updateStats(moves);
    updateStepInfo();
    showInfo(`成功加载 ${moves.length} 步棋谱`);
  } catch (err) {
    showError('解析失败: ' + err.message);
    document.getElementById('board').innerHTML = '';
    document.getElementById('stat-moves').textContent = 0;
    document.getElementById('stat-black').textContent = 0;
    document.getElementById('stat-white').textContent = 0;
    allMoves = [];
    currentStep = 0;
  }
}

// 清空所有
function clearAll() {
  document.getElementById('moves').value = '';
  document.getElementById('board').innerHTML = '';
  document.getElementById('stat-moves').textContent = 0;
  document.getElementById('stat-black').textContent = 0;
  document.getElementById('stat-white').textContent = 0;
  allMoves = [];
  currentStep = 0;
  updateStepInfo();
  clearMessages();
}

// 回车可视化
document.getElementById('moves').addEventListener('keydown', (e) => {
  if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
    visualize();
  }
});

// 按钮事件监听器
document.getElementById('btn-start').addEventListener('click', goToStart);
document.getElementById('btn-prev').addEventListener('click', goToPrev);
document.getElementById('btn-next').addEventListener('click', goToNext);
document.getElementById('btn-end').addEventListener('click', goToEnd);
</script>
</body>
</html>
