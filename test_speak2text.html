<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯­éŸ³è½¬æ–‡å­—</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .speech-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            text-align: center;
        }
        
        .mic-button {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: #3498db;
            border: none;
            color: white;
            font-size: 48px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }
        
        .mic-button:hover {
            background: #2980b9;
            transform: scale(1.05);
        }
        
        .mic-button.recording {
            background: #e74c3c;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
            }
            50% {
                box-shadow: 0 4px 25px rgba(231, 76, 60, 0.6);
            }
            100% {
                box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
            }
        }
        
        .status-text {
            font-size: 18px;
            color: #7f8c8d;
            margin-bottom: 20px;
            min-height: 25px;
        }
        
        .result-text {
            width: 90%;
            max-width: 600px;
            min-height: 200px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 12px;
            font-size: 16px;
            line-height: 1.6;
            background: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            text-align: left;
            white-space: pre-wrap;
            overflow-y: auto;
        }
        
        .clear-button {
            margin-top: 20px;
            padding: 10px 20px;
            background: #95a5a6;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s ease;
        }
        
        .clear-button:hover {
            background: #7f8c8d;
        }
        
        .error-message {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>è¯­éŸ³è½¬æ–‡å­—</h1>
        
        <div class="speech-container">
            <button id="micButton" class="mic-button">
                ğŸ¤
            </button>
            
            <div id="statusText" class="status-text">ç‚¹å‡»éº¦å…‹é£å¼€å§‹å½•éŸ³</div>
            
            <div id="resultText" class="result-text"></div>
            
            <button id="clearButton" class="clear-button">æ¸…ç©ºæ–‡æœ¬</button>
            
            <div id="errorMessage" class="error-message"></div>
        </div>
        
        <!-- åº•éƒ¨å¯¼èˆªæŒ‰é’® -->
        <div class="bottom-nav">
            <button class="btn" onclick="location.href='cw_home.html'">è¿”å›é¦–é¡µ</button>
            <button class="btn" onclick="location.href='cw_result.html'">æŸ¥çœ‹ç»“æœ</button>
            <button class="btn" onclick="location.href='cw_manager_milk.html'">ç®¡ç†å“é¡¹</button>
            <button class="btn" onclick="location.href='cookie.html'">Cookieç®¡ç†</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const micButton = document.getElementById('micButton');
            const statusText = document.getElementById('statusText');
            const resultText = document.getElementById('resultText');
            const clearButton = document.getElementById('clearButton');
            const errorMessage = document.getElementById('errorMessage');
            
            let recognition = null;
            let isRecording = false;
            
            // æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒè¯­éŸ³è¯†åˆ«
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                
                // é…ç½®è¯­éŸ³è¯†åˆ«
                recognition.continuous = true;  // æŒç»­è¯†åˆ«
                recognition.interimResults = true;  // æ˜¾ç¤ºä¸­é—´ç»“æœ
                recognition.lang = 'zh-CN';  // ä¸­æ–‡è¯†åˆ«
                
                // ç›‘å¬è¯†åˆ«ç»“æœ
                recognition.onresult = function(event) {
                    let interimTranscript = '';
                    let finalTranscript = '';
                    
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        const transcript = event.results[i][0].transcript;
                        if (event.results[i].isFinal) {
                            finalTranscript += transcript;
                        } else {
                            interimTranscript += transcript;
                        }
                    }
                    
                    if (finalTranscript) {
                        resultText.textContent += finalTranscript;
                    }
                    
                    if (interimTranscript) {
                        statusText.textContent = 'æ­£åœ¨è¯†åˆ«: ' + interimTranscript;
                    }
                };
                
                // ç›‘å¬é”™è¯¯
                recognition.onerror = function(event) {
                    console.error('è¯­éŸ³è¯†åˆ«é”™è¯¯:', event.error);
                    let errorMsg = 'è¯†åˆ«å‡ºé”™: ';
                    
                    switch(event.error) {
                        case 'no-speech':
                            errorMsg += 'æ²¡æœ‰æ£€æµ‹åˆ°è¯­éŸ³';
                            break;
                        case 'audio-capture':
                            errorMsg += 'æ— æ³•è®¿é—®éº¦å…‹é£';
                            break;
                        case 'not-allowed':
                            errorMsg += 'éº¦å…‹é£æƒé™è¢«æ‹’ç»';
                            break;
                        case 'network':
                            errorMsg += 'ç½‘ç»œé”™è¯¯';
                            break;
                        default:
                            errorMsg += event.error;
                    }
                    
                    errorMessage.textContent = errorMsg;
                    stopRecording();
                };
                
                // ç›‘å¬è¯†åˆ«ç»“æŸ
                recognition.onend = function() {
                    if (isRecording) {
                        // å¦‚æœè¿˜åœ¨å½•éŸ³çŠ¶æ€ï¼Œé‡æ–°å¼€å§‹è¯†åˆ«
                        recognition.start();
                    } else {
                        stopRecording();
                    }
                };
                
            } else {
                errorMessage.textContent = 'æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«åŠŸèƒ½';
                micButton.disabled = true;
                micButton.style.opacity = '0.5';
            }
            
            // éº¦å…‹é£æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            micButton.addEventListener('click', function() {
                if (!recognition) {
                    return;
                }
                
                if (isRecording) {
                    stopRecording();
                } else {
                    startRecording();
                }
            });
            
            // æ¸…ç©ºæŒ‰é’®ç‚¹å‡»äº‹ä»¶
            clearButton.addEventListener('click', function() {
                resultText.textContent = '';
                errorMessage.textContent = '';
                statusText.textContent = 'ç‚¹å‡»éº¦å…‹é£å¼€å§‹å½•éŸ³';
            });
            
            // å¼€å§‹å½•éŸ³
            function startRecording() {
                isRecording = true;
                micButton.classList.add('recording');
                statusText.textContent = 'æ­£åœ¨å½•éŸ³...';
                errorMessage.textContent = '';
                
                try {
                    recognition.start();
                } catch (error) {
                    console.error('å¯åŠ¨è¯­éŸ³è¯†åˆ«å¤±è´¥:', error);
                    errorMessage.textContent = 'å¯åŠ¨è¯­éŸ³è¯†åˆ«å¤±è´¥';
                    stopRecording();
                }
            }
            
            // åœæ­¢å½•éŸ³
            function stopRecording() {
                isRecording = false;
                micButton.classList.remove('recording');
                statusText.textContent = 'ç‚¹å‡»éº¦å…‹é£å¼€å§‹å½•éŸ³';
                
                if (recognition) {
                    try {
                        recognition.stop();
                    } catch (error) {
                        console.error('åœæ­¢è¯­éŸ³è¯†åˆ«å¤±è´¥:', error);
                    }
                }
            }
        });
    </script>
</body>
</html>